---
layout: post
title: "MAC子层"
date: 2025-11-19
tags: [学校课程复习,计算机网络]
comments: true
author: Ainski
---

# MAC子层是什么
用来确定多路访问信道的下一个使用者的协议属于数据链路层的一个子层，成为介质1访问控制（Medium Access Control）MAC子层

## 多路复用技术简单回顾，这是物理层部分的知识

![](../images/2025-11-19-5.png)
## 1 静态信道分配
假设一个容量为$C$ 的信道上发送一帧需要的平均延迟为$T$。假设帧随机到达，其平均到达率为$\lambda$ 帧/秒。帧的平均长度为$\frac{1}{\mu}$ 。即$\mu$ 表示 帧/比特
### 1.1 排队理论——M/M/1与平均时延公式
- 帧随机到达，到达间隔服从指数分布
$f(x)=\left\{\begin{array}{c} \frac{1}{\lambda} e^{-\frac{x}{\lambda}}, x>0 \\ 0, x \leq 0 \end{array} \quad(\theta>0)\right.$


## 2 动态信道分配
### 2.1 关键假设
- **流量独立** N个独立的站的发送互相独立
- **单信道** 所有的信道共享一条信道
- **冲突可观察** 所有的站都能够检测到冲突时间的发生。
- **时间连续或分槽**
- **载波侦听或不听**

### 2.2 纯aloha协议
[参考1](https://blog.csdn.net/u013669912/article/details/144479016)
[参考2](https://www.w3ccoo.com/articles/derive-the-efficiency-of-pure-aloha-protocol.html)
[参考3](https://blog.csdn.net/Jaihk662/article/details/80386620)
[参考4](https://zhuanlan.zhihu.com/p/20731045)
[参考5](https://zhuanlan.zhihu.com/p/593677462)

#### 关键思想
不监听信道，不按时间槽发送，随机重发。想发就发

#### 退避时间

此策略在纯 ALOHA 协议中起着至关重要的作用。当未收到数据包确认时，站点会等待一段更随机的时间，这段等待时间称为退避策略。

退避时间$$ (Tb) = k * RTT(往返时间)$$

其中 k 是站点选择的数值，一个 RTT 等于一个时隙。

![alt text](../images/2025-11-19-image.png)

#### 易受攻击时间
易受攻击时间是指数据包发生冲突的时间。如果第一个帧"A"在特定时间 t 发送，在数据传输完成之前，而另一个帧"B"在帧"A"完成之前开始，则会导致冲突。

发生冲突时的易受攻击时间 $$(Vt) = 2 * Tt$$

其中 Tt 是帧的传输时间。

脆弱时间也称为从站点传输完整数据包所需的传播时间或总时间。

$$\mathrm{脆弱时间=\:\frac{(消息长度)}{(传输信道带宽)}}$$


#### 最大效率
- 帧时T：发送一个标准长的帧所需的时间
- 吞吐率S：在一个帧时T内发送成功的平均帧数（ 0 < S < 1，S=1时信道利用率100%）
- 运载负载G：一个帧时T内所有通信站总共发送的帧平均值（包括原发和重发帧）（G≥S，G=S表示无冲突）
- P0：一帧发送成功（未发生冲突）的概率，发送成功的分组在已发送分组的总数中所占的比例；公式：S = G*P0

冲突危险期：时间长度为2T（过了这个时间就会再发生冲突了）
![alt text](../images/2025-11-19-image-2.png)


然而一个帧时内发生进站的帧数服从泊松分布$$P[k]=\frac{G^{k}e^{-G}}{k!}$$
那么在这个周期内发送成功的概率为2T内没有其他发送的概率。也就是两个帧时当中不会有其他帧发送。$$P_0=P[0]P[0]=e^{-2G}$$

那么能够正确发送的帧，也就是吞吐量为$$S=GP_0=Ge^{-2G}$$



$$\mathrm{\frac{\partial\:S}{\partial\:G}\:=(1-2G)(e^{-2G})}$$

$$\mathrm{\frac{\partial\:S}{\partial\:G}\:=\:0}$$

因此，当 G=1/2 并将 G 值代入吞吐量方程时，效率最高。

$$\mathrm{S\:=\:\frac{1}{2}\:*e^{-2(\frac{1}{2})}}$$ [由于 e^(-1) 的值0.367879]

$$\mathrm{S\:=\:\frac{1}{2}\:*e^{(-1)}}$$

$$\mathrm{S\:=\:\frac{1}{2}\:*\:0.367879}$$

$$\mathrm{S= 0.1839395}$$

纯 ALOHA 的效率百分比为 18.39%，由于碰撞次数较多，效率非常低。

### 2.3 时隙aloha协议

把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送。 控制想发就发的随意性

![alt text](../images/2025-11-19-image-1.png)

经过相同的运算方式，可以发现$$S=Ge^{-G}$$

有$G=1$时达到最大效率$S=e^{-1}$

![alt text](../images/2025-11-19-image-3.png)


#### 对于发包方

从站开始发包开始，重传次数k的概率分布为$$P(k)=(1-e^{-G})^{k-1} e^{-G}$$

这是一个几何分布，他的期望为 $E=e^G$

#### story

分槽aloha在有线电视网络中，发挥出难以想象的优势，但是距离它发明已经经过了很久，人们突然发觉了分槽aloha的绝妙之处。

### 2.4 Carrier Sense Multiple Access(CSMA)
#### 1-persistences csma
节点需要持续监听信道，一旦节点发现信道空闲后，则立刻发送数据。


#### 0-persistences csma

节点不连续监听信道，若该时刻节点监听信道为busy，那么等待一段时间后，再次进行监听。若节点该时刻监听信道为空闲，则立刻发送数据。

#### p-persistences csma
节点需要持续监听信道，一旦发现信道空闲后，节点以p的概率立刻发送数据，以1-p的概率不发送数据。若节点该时刻不发送数据，那么等待一段时间后，再次进行监听，并以p概率再次发送


### 2.5 csma/cd /ca
CSMA/CD:Carrier Sense Multiple Access with Collision Detection
CSMA/CA:Carrier Sense Multiple Access With Collision Avoidance

请注意，截断二进制指数退避算法，人为干预，帧间最小间隔属于csma/ca的部分。
#### 概述
- **多点接入(Multipoint Access/MA)**: **总线**型网络, 多个计算机站连接在一条总线上。
- **载波监听(Carrier Sense/CS)**: 即"边发送, 边监听", 不管在想要发送数据之前, 还是在发送数据之中, 每个站都必须不停的检测信道。发送前检测, 信道空闲才可以发送数据; 发送中检测, 若检测出其他信道在发送, 就中断本站的发送。
- **碰撞检测(Collision Detection/CD)**: 载波监听的物理实现, 边发送数据边检测信道上电压的变化情况。两个站同时在总线上发送数据时, 总线上的电压变化幅度将增大, 当两个数据碰撞时, 数据失真, 信号电压变化幅度超过门限值。此失真信号(电压变化幅度异常的信息)经一段时间后传至双方各站, 两站被检测到数据失真, 双方立即停止发送。

#### 碰撞检测
- **传播时延**: 数据是以电磁波的形式传输的, 某一方发送数据后, 需经过一定时间才能到达目的方。假设电缆为 $1km $则传播速率一般为 $2 \times 10^5 km/s$  传播时延约为 $\tau = 5 \mu s$
- **比特时间**: 发送 $n \mathrm{bit}$ (n为待发数据的长度)所需要的时间, 这样做的好处是可直接用比特数代替时间, 比如发送 100bit 的时间为 100 比特时间。一般为了方便说明时间, 下文会经常用比特时间代替常见的秒、微秒等。比特时间与数据传输速率有关, 若一个以太网的数据率为 10Mbps ,100比特时间则为 $$t=\frac{100bit}{10Mbps}=10\mu s$$

- 碰撞时间点
设时延为$\tau$ , A 在 t = 0 时发送数据，B在$t = \tau - \delta$ 的时候发送了数据。那么二者回发送碰撞，而这个时候，B发现信道是空的。

![ ](../images/2025-11-19-image-4.png)

$t=\tau - \delta$ 的时候，数据发生碰撞
$t=\tau$ B 发现冲突
$t=2 \tau - \delta$ A 发现冲突

#### 争用期

根据上面的结论。只要$t=\tau$的时候，B没有发送数据那么就回接收到信道被占用。只要经过了$t=2\tau$的时间没有发生冲突那么A就能一直发下去，因为线路上的所有站都会知道信道被占用了。

这个$t=2\tau$被之为**争用期**。

![alt text](../images/2025-11-19-image-5.png)



#### 截断二进制指数退避算法
- **算法目的**: 当发送数据双方检测出碰撞后, 利用此算法确定重传时机。
- **算法核心**: 当发送数据双方检测出碰撞后, 让双方各自等待一个随机的时间再重新发送。
    - 规定争用期取发送以太网最短帧512b的时间
    - 记AB双方重传次数为k，$n = \min{k,10}$。那么AB的重传时间为$r_A,r_B$ 。这两个数分别从$[0,1,3,\cdots,2^n-1]$ 当中随机选择一个。
    - k=16时仍然发送失败，丢弃掉本帧，向上层报告。
#### 人为干扰信号
当发送数据的站一旦发现发生了碰撞时, 除了立即停止发送数据外, 还要再继续发送 32 比特或 48 比特的人为干扰信号, 以便所有用户都知道已经发生碰撞。

另外,若发送人为干扰信号, 则退避算法的执行时间是等待发送完干扰信号后执行。
#### 帧间最小间隔
接收方接收一帧后, 为了让接收方的接收来得及清理, 做好接受下一帧的准备。于是规定若检测出信道空闲持续 96比特时间时, 才发送一帧。


---
layout: post
title: "MAC子层"
date: 2025-11-19
tags: [学校课程复习,计算机网络]
comments: true
author: Ainski
---

# MAC子层是什么
用来确定多路访问信道的下一个使用者的协议属于数据链路层的一个子层，成为介质1访问控制（Medium Access Control）MAC子层

## 多路复用技术简单回顾，这是物理层部分的知识

![](../images/2025-11-19-5.png)
## 1 静态信道分配
假设一个容量为$C$ 的信道上发送一帧需要的平均延迟为$T$。假设帧随机到达，其平均到达率为$\lambda$ 帧/秒。帧的平均长度为$\frac{1}{\mu}$ 。即$\mu$ 表示 帧/比特
### 1.1 排队理论——M/M/1与平均时延公式
- 帧随机到达，到达间隔服从指数分布
$f(x)=\left\{\begin{array}{c} \frac{1}{\lambda} e^{-\frac{x}{\lambda}}, x>0 \\ 0, x \leq 0 \end{array} \quad(\theta>0)\right.$

### 1.2 关于M/M/1 模型
此处借鉴(https://blog.csdn.net/zyx_bx/article/details/115219706)
#### 模型假设
- 到达时间是泊松分布 Poisson process
- 服务时间是指数分布 exponentially distributed
- 只有一部服务器 server
- 队列长度无限制
- 可加入队列的人数为无线

这种模型是一种出生-死亡过程，此随机过程中的每一个状态代表模型中人数的数目。因为模型的队列长度无限且参与人数亦无限，故此状态数目亦为无限。例如状态0表示模型闲置、状态1表示模型有一人在接受服务、状态2表示模型有二人（一人正接受服务、一人在等候），如此类推。 此模型中，出生率（即加入队列的速率）λ在各状态中均相同，死亡率（即完成服务离开队列的速率）μ亦在各状态中相同（除了状态0，因其不可能有人离开队列）。故此，在任何状态下，只有两种事情可能发生：
有人加入队列。如果模型在状态k，它会以速率λ进入状态k + 1
有人离开队列。如果模型在状态k（k不等于0），它会以速率μ进入状态k − 1
由此可见，模型的隐定条件为λ < μ。如果死亡率小于出生率，则队列中的平均人数为无限大，故此这种系统没有平衡点。

#### 变量定义
- $\mu$ 单位时间服务的顾客数，平均( 期望) 服务率
- $\lambda$ 单位时间前来的顾客数。
- $L_s$ 队长 ，系统中的顾客数（n）期望值
- $L_q$ 排队长 ，系统中排队等待服务的顾客数; 期望值记为Lq
- $W_s$ 逗留时间:—— 指一个顾客在系统中的全部停留时间 为 期望值
- $W_q$ 等待时间: —— 指一个顾客在系统中的排队等待时间为 期望值
- $W_s= W_q + E[服务时间]$
- $s$ 服务台数目
- $\rho = \frac{\lambda}{s\mu}$

那么有
- $P_0=1-\rho$ 
